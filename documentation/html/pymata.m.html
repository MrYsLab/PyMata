<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>PyMata.pymata API documentation</title>
    <meta name="description" content="Copyright (c) 2015-2018 Alan Yorinks All rights reserved.

This program is free software; you can re..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#PyMata.pymata.PyMata">PyMata</a></span>
        
          
  <ul>
    <li class="mono"><a href="#PyMata.pymata.PyMata.__init__">__init__</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.analog_mapping_query">analog_mapping_query</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.analog_read">analog_read</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.analog_write">analog_write</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.capability_query">capability_query</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.close">close</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.digital_read">digital_read</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.digital_write">digital_write</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.disable_analog_reporting">disable_analog_reporting</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.disable_digital_reporting">disable_digital_reporting</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.enable_analog_reporting">enable_analog_reporting</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.enable_digital_reporting">enable_digital_reporting</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.encoder_config">encoder_config</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.extended_analog">extended_analog</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_analog_latch_data">get_analog_latch_data</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_analog_mapping_request_results">get_analog_mapping_request_results</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_analog_response_table">get_analog_response_table</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_capability_query_results">get_capability_query_results</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_digital_latch_data">get_digital_latch_data</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_digital_response_table">get_digital_response_table</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_firmata_firmware_version">get_firmata_firmware_version</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_firmata_version">get_firmata_version</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_pin_state_query_results">get_pin_state_query_results</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_pymata_version">get_pymata_version</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_sonar_data">get_sonar_data</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.get_stepper_version">get_stepper_version</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.i2c_config">i2c_config</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.i2c_get_read_data">i2c_get_read_data</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.i2c_read">i2c_read</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.i2c_stop_reading">i2c_stop_reading</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.i2c_write">i2c_write</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.pin_state_query">pin_state_query</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.play_tone">play_tone</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.refresh_report_firmware">refresh_report_firmware</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.refresh_report_version">refresh_report_version</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.reset">reset</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.servo_config">servo_config</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.set_analog_latch">set_analog_latch</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.set_digital_latch">set_digital_latch</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.set_pin_mode">set_pin_mode</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.set_sampling_interval">set_sampling_interval</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.sonar_config">sonar_config</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.stepper_config">stepper_config</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.stepper_request_library_version">stepper_request_library_version</a></li>
    <li class="mono"><a href="#PyMata.pymata.PyMata.stepper_step">stepper_step</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">PyMata.pymata</span> module</h1>
  <p>Copyright (c) 2015-2018 Alan Yorinks All rights reserved.</p>
<p>This program is free software; you can redistribute it and/or
modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE
Version 3 as published by the Free Software Foundation; either
or (at your option) any later version.
This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.</p>
<p>You should have received a copy of the GNU AFFERO GENERAL PUBLIC LICENSE
along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> Copyright (c) 2015-2018 Alan Yorinks All rights reserved.</span>

<span class="sd"> This program is free software; you can redistribute it and/or</span>
<span class="sd"> modify it under the terms of the GNU AFFERO GENERAL PUBLIC LICENSE</span>
<span class="sd"> Version 3 as published by the Free Software Foundation; either</span>
<span class="sd"> or (at your option) any later version.</span>
<span class="sd"> This library is distributed in the hope that it will be useful,</span>
<span class="sd"> but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd"> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="sd"> General Public License for more details.</span>

<span class="sd"> You should have received a copy of the GNU AFFERO GENERAL PUBLIC LICENSE</span>
<span class="sd"> along with this library; if not, write to the Free Software</span>
<span class="sd"> Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">.pymata_serial</span> <span class="kn">import</span> <span class="n">PyMataSerial</span>
<span class="kn">from</span> <span class="nn">.pymata_command_handler</span> <span class="kn">import</span> <span class="n">PyMataCommandHandler</span>

<span class="c1"># For report data formats refer to http://firmata.org/wiki/Protocol</span>


<span class="c1"># noinspection PyPep8</span>
<span class="k">class</span> <span class="nc">PyMata</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains the complete set of API methods that permit control of an Arduino</span>
<span class="sd">    Micro-Controller utilizing Firmata or its derivatives.</span>

<span class="sd">    For information about the Firmata protocol, refer to: http://firmata.org/wiki/Protocol</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># some state variables</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># digital pin state high value</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># digital pin state low value</span>

    <span class="n">REPORTING_ENABLE</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># enable reporting for REPORT_ANALOG or REPORT_DIGITAL message sent to firmata</span>
    <span class="n">REPORTING_DISABLE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># disable reporting for REPORT_ANALOG or REPORT_DIGITAL message sent to firmata</span>

    <span class="c1"># Shared Resources - data structures, controlling mechanisms, and reference variables</span>

    <span class="c1"># Commands and data received from Firmata via the serial interface are placed into the command deque.</span>
    <span class="c1"># The pymata_command_handler class removes and processes this information.</span>
    <span class="n">command_deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="c1"># This is the instance reference to the communications port object</span>
    <span class="n">arduino</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># This is  a thread lock to assure data integrity when reading or writing to the data response tables</span>
    <span class="c1"># (defined in the CommandHandler class). It shared by the pymata class and the pymata_command_handler class.</span>
    <span class="n">data_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>

    <span class="c1"># This is the instance reference to the _command_handler</span>
    <span class="n">_command_handler</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># verbose can be set to false to suppress output to the console when instantiating PyMata</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># pin modes</span>
    <span class="n">INPUT</span> <span class="o">=</span> <span class="mh">0x00</span>  <span class="c1"># pin set as input</span>
    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="mh">0x01</span>  <span class="c1"># pin set as output</span>
    <span class="n">ANALOG</span> <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1"># analog pin in analogInput mode</span>
    <span class="n">PWM</span> <span class="o">=</span> <span class="mh">0x03</span>  <span class="c1"># digital pin in PWM output mode</span>
    <span class="n">SERVO</span> <span class="o">=</span> <span class="mh">0x04</span>  <span class="c1"># digital pin in Servo output mode</span>
    <span class="n">I2C</span> <span class="o">=</span> <span class="mh">0x06</span>  <span class="c1"># pin included in I2C setup</span>
    <span class="n">ONEWIRE</span> <span class="o">=</span> <span class="mh">0x07</span>  <span class="c1"># possible future feature</span>
    <span class="n">STEPPER</span> <span class="o">=</span> <span class="mh">0x08</span>  <span class="c1"># any pin in stepper mode</span>
    <span class="n">ENCODER</span> <span class="o">=</span> <span class="mh">0x09</span>  <span class="c1"># Any pin in encoder mode</span>
    <span class="n">SERIAL</span> <span class="o">=</span> <span class="mh">0x0a</span>
    <span class="n">PULLUP</span> <span class="o">=</span> <span class="mh">0x0b</span>  <span class="c1"># Any pin in pullup mode</span>
    <span class="n">SONAR</span> <span class="o">=</span> <span class="mh">0x0c</span>  <span class="c1"># Any pin in SONAR mode</span>
    <span class="n">TONE</span> <span class="o">=</span> <span class="mh">0x0d</span>  <span class="c1"># Any pin in tone mode</span>
    <span class="n">IGNORE</span> <span class="o">=</span> <span class="mh">0x7f</span>
    <span class="n">LATCH_MODE</span> <span class="o">=</span> <span class="mh">0xE0</span>  <span class="c1"># this value is or&#39;ed with pin modes for latched data callback</span>

    <span class="c1"># the following pin modes are not part of or defined by Firmata</span>
    <span class="c1"># but used by PyMata</span>
    <span class="n">DIGITAL</span> <span class="o">=</span> <span class="mh">0x20</span>

    <span class="c1"># I2C command operation modes</span>
    <span class="n">I2C_WRITE</span> <span class="o">=</span> <span class="mb">0B00000000</span>
    <span class="n">I2C_READ</span> <span class="o">=</span> <span class="mb">0B00001000</span>
    <span class="n">I2C_READ_CONTINUOUSLY</span> <span class="o">=</span> <span class="mb">0B00010000</span>
    <span class="n">I2C_STOP_READING</span> <span class="o">=</span> <span class="mb">0B00011000</span>
    <span class="n">I2C_READ_WRITE_MODE_MASK</span> <span class="o">=</span> <span class="mb">0B00011000</span>

    <span class="c1"># Tone commands</span>
    <span class="n">TONE_TONE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># play a tone</span>
    <span class="n">TONE_NO_TONE</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># turn off tone</span>

    <span class="c1"># Stepper Motor Sub-commands</span>
    <span class="n">STEPPER_CONFIGURE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># configure a stepper motor for operation</span>
    <span class="n">STEPPER_STEP</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># command a motor to move at the provided speed</span>
    <span class="n">STEPPER_LIBRARY_VERSION</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># used to get stepper library version number</span>

    <span class="c1"># each byte represents a digital port and its value contains the current port settings</span>
    <span class="n">digital_output_port_pins</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
                                <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">]</span>

    <span class="c1"># noinspection PyPep8Naming</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="o">=</span><span class="s1">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="n">bluetooth</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">baud_rate</span><span class="o">=</span><span class="mi">57600</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &quot;constructor&quot; instantiates the entire interface. It starts the operational threads for the serial</span>
<span class="sd">        interface as well as for the command handler.</span>

<span class="sd">        :param port_id: Communications port specifier (COM3, /dev/ttyACM0, etc)</span>

<span class="sd">        :param bluetooth: Sets start up delays for bluetooth connectivity. Set to False for faster start up.</span>

<span class="sd">        :param verbose: If set to False, the status print statements are suppressed.</span>

<span class="sd">        :param baud_rate: Set serial baud rate. Must match that of Firmata sketch on Arduino</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Currently only serial communication over USB is supported, but in the future</span>
        <span class="c1"># wifi and other transport mechanism support is anticipated</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">baud_rate</span> <span class="o">=</span> <span class="n">baud_rate</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># save the user&#39;s request if specified</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>


            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Python Version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">PyMata version 2.18  Copyright(C) 2013-18 Alan Yorinks    All rights reserved.&#39;</span><span class="p">)</span>

            <span class="c1"># Instantiate the serial support class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">PyMataSerial</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_deque</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baud_rate</span><span class="p">)</span>

            <span class="c1"># wait for HC-06 Bluetooth slave to initialize in case it is being used.</span>
            <span class="k">if</span> <span class="n">bluetooth</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="c1"># Attempt opening communications with the Arduino micro-controller</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

            <span class="c1"># additional wait for HC-06 if it is being used</span>
            <span class="k">if</span> <span class="n">bluetooth</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># necessary to support Arduino Mega</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Start the data receive thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># Instantiate the command handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span> <span class="o">=</span> <span class="n">PyMataCommandHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>

            <span class="c1">########################################################################</span>
            <span class="c1"># constants defined locally from values contained in the command handler</span>
            <span class="c1">########################################################################</span>

            <span class="c1"># Data latch state constants to be used when accessing data returned from get_latch_data methods.</span>
            <span class="c1"># The get_latch data methods return [pin_number, latch_state, latched_data, time_stamp]</span>
            <span class="c1"># These three constants define possible values for the second item in the list, latch_state</span>

            <span class="c1"># this pin will be ignored for latching - table initialized with this value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_IGNORE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_IGNORE</span>
            <span class="c1"># When the next pin value change is received for this pin, if it matches the latch criteria</span>
            <span class="c1"># the data will be latched.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_ARMED</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_ARMED</span>
            <span class="c1"># Data has been latched. Read the data to re-arm the latch.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_LATCHED</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_LATCHED</span>

            <span class="c1">#</span>
            <span class="c1"># These constants are used when setting a data latch.</span>
            <span class="c1"># Latch threshold types</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span>

            <span class="c1"># constants to be used to parse the data returned from calling</span>
            <span class="c1"># get_X_latch_data()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_PIN</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_STATE</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCHED_DATA</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCHED_TIME_STAMP</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="c1"># Start the command processing thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># Command handler should now be prepared to receive replies from the Arduino, so go ahead</span>
            <span class="c1"># detect the Arduino board</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please wait while Arduino is being detected. This can take up to 30 seconds ...&#39;</span><span class="p">)</span>

            <span class="c1"># perform board auto discovery</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">auto_discover_board</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
                <span class="c1"># board was not found so shutdown</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Board Auto Discovery Failed!, Shutting Down&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Program Aborted Before PyMata Instantiated&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">analog_mapping_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send an analog mapping query message via sysex. Client retrieves the results with a</span>
<span class="sd">        call to get_analog_mapping_request_results()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MAPPING_QUERY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">analog_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the last analog data value received for the specified pin.</span>

<span class="sd">        :param pin: Selected pin</span>

<span class="sd">        :return: The last value entered into the analog response table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_PIN_DATA_VALUE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">analog_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the specified pin to the specified value.</span>

<span class="sd">        :param pin: Pin number</span>

<span class="sd">        :param value: Pin value</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MESSAGE</span> <span class="o">+</span> <span class="n">pin</span> <span class="o">&lt;</span> <span class="mh">0xf0</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MESSAGE</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extended_analog</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">capability_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a Firmata capability query message via sysex. Client retrieves the results with a</span>
<span class="sd">        call to get_capability_query_results()</span>
<span class="sd">        The Arduino can be rather slow in responding to this command. For </span>
<span class="sd">        the Mega 2560 R3 it has taken up to 25 seconds for a response.   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">CAPABILITY_QUERY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will close the transport (serial port) and exit</span>
<span class="sd">        :return: No return value, but sys.exit(0) is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;PyMata close(): Calling sys.exit(0): Hope to see you soon!&quot;</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">digital_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the last digital data value received for the specified pin.</span>
<span class="sd">        NOTE: This command will return values for digital, pwm, etc,  pin types</span>

<span class="sd">        :param pin: Selected pin</span>

<span class="sd">        :return: The last value entered into the digital response table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_PIN_DATA_VALUE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>


    <span class="k">def</span> <span class="nf">digital_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the specified pin to the specified value.</span>

<span class="sd">        :param pin: pin number</span>

<span class="sd">        :param value: pin value</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The command value is not a fixed value, but needs to be calculated using the</span>
        <span class="c1"># pin&#39;s port number</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>

        <span class="n">calculated_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_MESSAGE</span> <span class="o">+</span> <span class="n">port</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">pin</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c1"># Calculate the value for the pin&#39;s position in the port mask</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">|=</span> <span class="n">mask</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span>

        <span class="c1"># Assemble the command</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="n">calculated_command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">disable_analog_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables analog reporting for a single analog pin.</span>

<span class="sd">        :param pin: Analog pin number. For example for A0, the number is 0.</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_ANALOG</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_DISABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">disable_digital_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables digital reporting. By turning reporting off for this pin, reporting</span>
<span class="sd">        is disabled for all 8 bits in the &quot;port&quot; -</span>

<span class="sd">        :param pin: Pin and all pins for this port</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_DIGITAL</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_DISABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">enable_analog_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables analog reporting. By turning reporting on for a single pin.</span>

<span class="sd">        :param pin: Analog pin number. For example for A0, the number is 0.</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_ANALOG</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_ENABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">enable_digital_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables digital reporting. By turning reporting on for all 8 bits in the &quot;port&quot; -</span>
<span class="sd">        this is part of Firmata&#39;s protocol specification.</span>

<span class="sd">        :param pin: Pin and all pins for this port</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_DIGITAL</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_ENABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">encoder_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin_a</span><span class="p">,</span> <span class="n">pin_b</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This command enables the rotary encoder (2 pin + ground) and will</span>
<span class="sd">        enable encoder reporting.</span>

<span class="sd">        NOTE: This command is not currently part of standard arduino firmata, but is provided for legacy</span>
<span class="sd">        support of CodeShield on an Arduino UNO.</span>

<span class="sd">        Encoder data is retrieved by performing a digital_read from pin a (encoder pin 1)</span>

<span class="sd">        :param pin_a: Encoder pin 1.</span>

<span class="sd">        :param pin_b: Encoder pin 2.</span>

<span class="sd">        :param cb: callback function to report encoder changes</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin_a</span><span class="p">,</span> <span class="n">pin_b</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCODER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin_a</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCODER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin_b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ENCODER_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">extended_analog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will send an extended data analog output command to the selected pin</span>

<span class="sd">        :param pin: 0 - 127</span>

<span class="sd">        :param data: 0 - 0xfffff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analog_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin</span><span class="p">,</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">EXTENDED_ANALOG</span><span class="p">,</span> <span class="n">analog_data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_analog_latch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list is returned containing the latch state for the pin, the latched value, and the time stamp</span>
<span class="sd">        [pin_num, latch_state, latched_value, time_stamp]</span>
<span class="sd">        If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</span>

<span class="sd">        :param pin: Pin number.</span>

<span class="sd">        :return: [pin, latch_state, latch_data_value, time_stamp]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_analog_latch_data</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_analog_mapping_request_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method after calling analog_mapping_query() to retrieve its results</span>
<span class="sd">        :return: raw data returned by firmata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_mapping_query_results</span>


    <span class="k">def</span> <span class="nf">get_analog_response_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of lists representing the current pin mode and</span>
<span class="sd">        associated data values for all analog pins.</span>
<span class="sd">        All configured pin types, both input and output will be listed. Output pin data will contain zero.</span>
<span class="sd">        :return: The last update of the digital response table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_analog_response_table</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">get_capability_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the data returned by a previous call to capability_query()</span>
<span class="sd">        :return: Raw capability data returned by firmata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">capability_query_results</span>


    <span class="k">def</span> <span class="nf">get_digital_latch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list is returned containing the latch state for the pin, the latched value, and the time stamp</span>
<span class="sd">        [pin_num, latch_state, latched_value, time_stamp]</span>
<span class="sd">        If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</span>

<span class="sd">        :param pin: Pin number.</span>

<span class="sd">        :return: [pin, latch_state, latch_data_value, time_stamp]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_digital_latch_data</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_digital_response_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of lists representing the current pin mode</span>
<span class="sd">        and associated data for all digital pins.</span>
<span class="sd">        All pin types, both input and output will be listed. Output pin data will contain zero.</span>
<span class="sd">        :return: The last update of the digital response table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_digital_response_table</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">get_firmata_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the firmata version information returned by a previous call to refresh_report_version()</span>
<span class="sd">        :return: Firmata_version list [major, minor] or None</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">firmata_version</span>


    <span class="k">def</span> <span class="nf">get_firmata_firmware_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the firmware id information returned by a previous call to refresh_report_firmware()</span>
<span class="sd">        :return: Firmata_firmware  list [major, minor, file_name] or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">firmata_firmware</span>


    <span class="k">def</span> <span class="nf">get_pin_state_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the results of a previous call to pin_state_query() and then resets</span>
<span class="sd">        the pin state query data to None</span>

<span class="sd">        :return: Raw pin state query data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">last_pin_query_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">last_pin_query_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">r_data</span>


    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">get_pymata_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the PyMata version number in a list: [Major Number, Minor Number]</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">]</span>


    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">get_sonar_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve Ping (HC-SR04 type) data. The data is presented as a dictionary.</span>
<span class="sd">        The &#39;key&#39; is the trigger pin specified in sonar_config() and the &#39;data&#39; is the</span>
<span class="sd">        current measured distance (in centimeters)</span>
<span class="sd">        for that pin. If there is no data, the value is set to IGNORE (127).</span>

<span class="sd">        :return: active_sonar_map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span>


    <span class="k">def</span> <span class="nf">get_stepper_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the stepper library version number.</span>

<span class="sd">        :param timeout: specify a time to allow arduino to process and return a version</span>

<span class="sd">        :return: the stepper version number if it was set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current time</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># wait for up to 20 seconds for a successful capability query to occur</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stepper_library_version</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Stepper Library Version Request timed-out. &quot;</span>
                          <span class="s2">&quot;Did you send a stepper_request_library_version command?&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stepper_library_version</span>


    <span class="k">def</span> <span class="nf">i2c_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read_delay_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clk_pin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_pin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOTE: THIS METHOD MUST BE CALLED BEFORE ANY I2C REQUEST IS MADE</span>
<span class="sd">        This method initializes Firmata for I2c operations.</span>
<span class="sd">        It allows setting of a read time delay amount, and to optionally track</span>
<span class="sd">        the pins as I2C in the appropriate response table.</span>
<span class="sd">        To track pins: Set the pin_type to ANALOG or DIGITAL and provide the pin numbers.</span>
<span class="sd">        If using ANALOG, pin numbers use the analog number, for example A4: use 4.</span>

<span class="sd">        :param read_delay_time: an optional parameter, default is 0</span>

<span class="sd">        :param pin_type: ANALOG or DIGITAL to select response table type to track pin numbers</span>

<span class="sd">        :param clk_pin: pin number (see comment above).</span>

<span class="sd">        :param data_pin: pin number (see comment above).</span>

<span class="sd">        :return: No Return Value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_delay_time</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">read_delay_time</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># If pin type is set, set pin mode in appropriate response table for these pins</span>
        <span class="k">if</span> <span class="n">pin_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">clk_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">data_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">clk_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">data_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>


    <span class="k">def</span> <span class="nf">i2c_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">number_of_bytes</span><span class="p">,</span> <span class="n">read_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method requests the read of an i2c device. Results are retrieved by a call to</span>
<span class="sd">        i2c_get_read_data().</span>
<span class="sd">        If a callback method is provided, when data is received from the device it will be sent to the callback method</span>

<span class="sd">        :param address: i2c device address</span>

<span class="sd">        :param register: register number (can be set to zero)</span>

<span class="sd">        :param number_of_bytes: number of bytes expected to be returned</span>

<span class="sd">        :param read_type: I2C_READ  or I2C_READ_CONTINUOUSLY</span>

<span class="sd">        :param cb: Optional callback function to report i2c data as result of read command</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="n">read_type</span><span class="p">,</span> <span class="n">register</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">register</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                <span class="n">number_of_bytes</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_bytes</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>

        <span class="c1"># add or update entry in i2c_map for reply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cb</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">i2c_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write data to an i2c device.</span>

<span class="sd">        :param address: i2c device address</span>

<span class="sd">        :param args: A variable number of bytes to be sent to the device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C_WRITE</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">i2c_stop_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method stops an I2C_READ_CONTINUOUSLY operation for the i2c device address specified.</span>

<span class="sd">        :param address: address of i2c device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C_STOP_READING</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">i2c_get_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method retrieves the i2c read data as the result of an i2c_read() command.</span>

<span class="sd">        :param address: i2c device address</span>

<span class="sd">        :return: raw data read from device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">:</span>
            <span class="n">map_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">[</span><span class="n">address</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">map_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">pin_state_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method issues a pin state query command. Data returned is retrieved via</span>
<span class="sd">        a call to get_pin_state_query_results()</span>
<span class="sd">        :param pin: pin number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">PIN_STATE_QUERY</span><span class="p">,</span> <span class="p">[</span><span class="n">pin</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">play_tone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">tone_command</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will call the Tone library for the selected pin.</span>
<span class="sd">        If the tone command is set to TONE_TONE, then the specified tone will be played.</span>
<span class="sd">        Else, if the tone command is TONE_NO_TONE, then any currently playing tone will be disabled.</span>
<span class="sd">        It is intended for a future release of Arduino Firmata</span>

<span class="sd">        :param pin: Pin number</span>

<span class="sd">        :param tone_command: Either TONE_TONE, or TONE_NO_TONE</span>

<span class="sd">        :param frequency: Frequency of tone</span>

<span class="sd">        :param duration: Duration of tone in milliseconds</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># convert the integer values to bytes</span>
        <span class="k">if</span> <span class="n">tone_command</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TONE_TONE</span><span class="p">:</span>
            <span class="c1"># duration is specified</span>
            <span class="k">if</span> <span class="n">duration</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">frequency</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="n">duration</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">frequency</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">TONE</span>
        <span class="c1"># turn off tone</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">TONE_PLAY</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">refresh_report_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will query firmata for the report version.</span>
<span class="sd">        Retrieve the report version via a call to get_firmata_version()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_VERSION</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">refresh_report_firmware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will query firmata to report firmware. Retrieve the report via a</span>
<span class="sd">        call to get_firmata_firmware_version()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_FIRMWARE</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This command sends a reset message to the Arduino. The response tables will be reinitialized</span>
<span class="sd">        :return: No return value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set all output pins to a value of 0</span>
        <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">total_pins_discovered</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVO</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TONE</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TONE_NO_TONE</span><span class="p">,</span> <span class="n">pin</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">TONE_PLAY</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">set_analog_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method &quot;arms&quot; an analog pin for its data to be latched and saved in the latching table</span>
<span class="sd">        If a callback method is provided, when latching criteria is achieved, the callback function is called</span>
<span class="sd">        with latching data notification. In that case, the latching table is not updated.</span>

<span class="sd">        :param pin: Analog pin number (value following an &#39;A&#39; designator, i.e. A5 = 5</span>

<span class="sd">        :param threshold_type: ANALOG_LATCH_GT | ANALOG_LATCH_LT  | ANALOG_LATCH_GTE | ANALOG_LATCH_LTE</span>

<span class="sd">        :param threshold_value: numerical value - between 0 and 1023</span>

<span class="sd">        :param cb: callback method</span>

<span class="sd">        :return: True if successful, False if parameter data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span> <span class="o">&lt;=</span> <span class="n">threshold_type</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">threshold_value</span> <span class="o">&lt;=</span> <span class="mi">1023</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">set_analog_latch</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">set_digital_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method &quot;arms&quot; a digital pin for its data to be latched and saved in the latching table</span>
<span class="sd">        If a callback method is provided, when latching criteria is achieved, the callback function is called</span>
<span class="sd">        with latching data notification. In that case, the latching table is not updated.</span>

<span class="sd">        :param pin: Digital pin number</span>

<span class="sd">        :param threshold_type: DIGITAL_LATCH_HIGH | DIGITAL_LATCH_LOW</span>

<span class="sd">        :param cb: callback function</span>

<span class="sd">        :return: True if successful, False if parameter data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">threshold_type</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">set_digital_latch</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">set_pin_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">pin_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets a pin to the desired pin mode for the pin_type.</span>
<span class="sd">        It automatically enables data reporting.</span>
<span class="sd">        NOTE: DO NOT CALL THIS METHOD FOR I2C. See i2c_config().</span>

<span class="sd">        :param pin: Pin number (for analog use the analog number, for example A4: use 4)</span>

<span class="sd">        :param mode: INPUT, OUTPUT, PWM, PULLUP</span>

<span class="sd">        :param pin_type: ANALOG or DIGITAL</span>

<span class="sd">        :param cb: This is an optional callback function to report data changes to the user</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SET_PIN_MODE</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># enable reporting for input pins</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PULLUP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">:</span>

                <span class="c1"># set analog response table to show this pin is an input pin</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_analog_reporting</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
            <span class="c1"># if not analog it has to be digital</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># must be output - so set the tables accordingly</span>
            <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>


    <span class="k">def</span> <span class="nf">set_sampling_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sends the desired sampling interval to Firmata.</span>
<span class="sd">        Note: Standard Firmata  will ignore any interval less than 10 milliseconds</span>

<span class="sd">        :param interval: Integer value for desired sampling interval in milliseconds</span>

<span class="sd">        :return: No return value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">interval</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">interval</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SAMPLING_INTERVAL</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">servo_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">min_pulse</span><span class="o">=</span><span class="mi">544</span><span class="p">,</span> <span class="n">max_pulse</span><span class="o">=</span><span class="mi">2400</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure a pin as a servo pin. Set pulse min, max in ms.</span>

<span class="sd">        :param pin: Servo Pin.</span>

<span class="sd">        :param min_pulse: Min pulse width in ms.</span>

<span class="sd">        :param max_pulse: Max pulse width in ms.</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin</span><span class="p">,</span> <span class="n">min_pulse</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">min_pulse</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                   <span class="n">max_pulse</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">max_pulse</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SERVO_CONFIG</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">sonar_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trigger_pin</span><span class="p">,</span> <span class="n">echo_pin</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ping_interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure the pins,ping interval and maximum distance for an HC-SR04 type device.</span>
<span class="sd">        Single pin configuration may be used. To do so, set both the trigger and echo pins to the same value.</span>
<span class="sd">        Up to a maximum of 6 SONAR devices is supported</span>
<span class="sd">        If the maximum is exceeded a message is sent to the console and the request is ignored.</span>
<span class="sd">        NOTE: data is measured in centimeters</span>

<span class="sd">        :param trigger_pin: The pin number of for the trigger (transmitter).</span>

<span class="sd">        :param echo_pin: The pin number for the received echo.</span>

<span class="sd">        :param ping_interval: Minimum interval between pings. Lowest number to use is 33 ms.Max is 127</span>

<span class="sd">        :param max_distance: Maximum distance in cm. Max is 200.</span>

<span class="sd">        :param cb: optional callback function to report sonar data changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_distance</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">max_distance</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">max_distance_lsb</span> <span class="o">=</span> <span class="n">max_distance</span> <span class="o">&amp;</span> <span class="mh">0x7f</span>
        <span class="n">max_distance_msb</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_distance</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">trigger_pin</span><span class="p">,</span> <span class="n">echo_pin</span><span class="p">,</span> <span class="n">ping_interval</span><span class="p">,</span> <span class="n">max_distance_lsb</span><span class="p">,</span> <span class="n">max_distance_msb</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">trigger_pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">echo_pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
        <span class="c1"># update the ping data map for this pin</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sonar_config: maximum number of devices assigned - ignoring request&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>

                <span class="c1"># self._command_handler.active_sonar_map[trigger_pin] = self.IGNORE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span><span class="p">[</span><span class="n">trigger_pin</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cb</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SONAR_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stepper_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps_per_revolution</span><span class="p">,</span> <span class="n">stepper_pins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure stepper motor prior to operation.</span>

<span class="sd">        :param steps_per_revolution: number of steps per motor revolution</span>

<span class="sd">        :param stepper_pins: a list of control pin numbers - either 4 or 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_CONFIGURE</span><span class="p">,</span> <span class="n">steps_per_revolution</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">steps_per_revolution</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stepper_pins</span><span class="p">)):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stepper_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stepper_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor_speed</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move a stepper motor for the number of steps at the specified speed</span>

<span class="sd">        :param motor_speed: 21 bits of data to set motor speed</span>

<span class="sd">        :param number_of_steps: 14 bits for number of steps &amp; direction</span>
<span class="sd">                                positive is forward, negative is reverse</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">number_of_steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">abs_number_of_steps</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_STEP</span><span class="p">,</span> <span class="n">motor_speed</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">motor_speed</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">motor_speed</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                <span class="n">abs_number_of_steps</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">abs_number_of_steps</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="n">direction</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stepper_request_library_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request the stepper library version from the Arduino.</span>
<span class="sd">        To retrieve the version after this command is called, call</span>
<span class="sd">        get_stepper_version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_LIBRARY_VERSION</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="PyMata.pymata.PyMata" class="name">class <span class="ident">PyMata</span></p>
      
  
    <div class="desc"><p>This class contains the complete set of API methods that permit control of an Arduino
Micro-Controller utilizing Firmata or its derivatives.</p>
<p>For information about the Firmata protocol, refer to: http://firmata.org/wiki/Protocol</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PyMata</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains the complete set of API methods that permit control of an Arduino</span>
<span class="sd">    Micro-Controller utilizing Firmata or its derivatives.</span>

<span class="sd">    For information about the Firmata protocol, refer to: http://firmata.org/wiki/Protocol</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># some state variables</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># digital pin state high value</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># digital pin state low value</span>

    <span class="n">REPORTING_ENABLE</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># enable reporting for REPORT_ANALOG or REPORT_DIGITAL message sent to firmata</span>
    <span class="n">REPORTING_DISABLE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># disable reporting for REPORT_ANALOG or REPORT_DIGITAL message sent to firmata</span>

    <span class="c1"># Shared Resources - data structures, controlling mechanisms, and reference variables</span>

    <span class="c1"># Commands and data received from Firmata via the serial interface are placed into the command deque.</span>
    <span class="c1"># The pymata_command_handler class removes and processes this information.</span>
    <span class="n">command_deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="c1"># This is the instance reference to the communications port object</span>
    <span class="n">arduino</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># This is  a thread lock to assure data integrity when reading or writing to the data response tables</span>
    <span class="c1"># (defined in the CommandHandler class). It shared by the pymata class and the pymata_command_handler class.</span>
    <span class="n">data_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>

    <span class="c1"># This is the instance reference to the _command_handler</span>
    <span class="n">_command_handler</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># verbose can be set to false to suppress output to the console when instantiating PyMata</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># pin modes</span>
    <span class="n">INPUT</span> <span class="o">=</span> <span class="mh">0x00</span>  <span class="c1"># pin set as input</span>
    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="mh">0x01</span>  <span class="c1"># pin set as output</span>
    <span class="n">ANALOG</span> <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1"># analog pin in analogInput mode</span>
    <span class="n">PWM</span> <span class="o">=</span> <span class="mh">0x03</span>  <span class="c1"># digital pin in PWM output mode</span>
    <span class="n">SERVO</span> <span class="o">=</span> <span class="mh">0x04</span>  <span class="c1"># digital pin in Servo output mode</span>
    <span class="n">I2C</span> <span class="o">=</span> <span class="mh">0x06</span>  <span class="c1"># pin included in I2C setup</span>
    <span class="n">ONEWIRE</span> <span class="o">=</span> <span class="mh">0x07</span>  <span class="c1"># possible future feature</span>
    <span class="n">STEPPER</span> <span class="o">=</span> <span class="mh">0x08</span>  <span class="c1"># any pin in stepper mode</span>
    <span class="n">ENCODER</span> <span class="o">=</span> <span class="mh">0x09</span>  <span class="c1"># Any pin in encoder mode</span>
    <span class="n">SERIAL</span> <span class="o">=</span> <span class="mh">0x0a</span>
    <span class="n">PULLUP</span> <span class="o">=</span> <span class="mh">0x0b</span>  <span class="c1"># Any pin in pullup mode</span>
    <span class="n">SONAR</span> <span class="o">=</span> <span class="mh">0x0c</span>  <span class="c1"># Any pin in SONAR mode</span>
    <span class="n">TONE</span> <span class="o">=</span> <span class="mh">0x0d</span>  <span class="c1"># Any pin in tone mode</span>
    <span class="n">IGNORE</span> <span class="o">=</span> <span class="mh">0x7f</span>
    <span class="n">LATCH_MODE</span> <span class="o">=</span> <span class="mh">0xE0</span>  <span class="c1"># this value is or&#39;ed with pin modes for latched data callback</span>

    <span class="c1"># the following pin modes are not part of or defined by Firmata</span>
    <span class="c1"># but used by PyMata</span>
    <span class="n">DIGITAL</span> <span class="o">=</span> <span class="mh">0x20</span>

    <span class="c1"># I2C command operation modes</span>
    <span class="n">I2C_WRITE</span> <span class="o">=</span> <span class="mb">0B00000000</span>
    <span class="n">I2C_READ</span> <span class="o">=</span> <span class="mb">0B00001000</span>
    <span class="n">I2C_READ_CONTINUOUSLY</span> <span class="o">=</span> <span class="mb">0B00010000</span>
    <span class="n">I2C_STOP_READING</span> <span class="o">=</span> <span class="mb">0B00011000</span>
    <span class="n">I2C_READ_WRITE_MODE_MASK</span> <span class="o">=</span> <span class="mb">0B00011000</span>

    <span class="c1"># Tone commands</span>
    <span class="n">TONE_TONE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># play a tone</span>
    <span class="n">TONE_NO_TONE</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># turn off tone</span>

    <span class="c1"># Stepper Motor Sub-commands</span>
    <span class="n">STEPPER_CONFIGURE</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># configure a stepper motor for operation</span>
    <span class="n">STEPPER_STEP</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># command a motor to move at the provided speed</span>
    <span class="n">STEPPER_LIBRARY_VERSION</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># used to get stepper library version number</span>

    <span class="c1"># each byte represents a digital port and its value contains the current port settings</span>
    <span class="n">digital_output_port_pins</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
                                <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">]</span>

    <span class="c1"># noinspection PyPep8Naming</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="o">=</span><span class="s1">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="n">bluetooth</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">baud_rate</span><span class="o">=</span><span class="mi">57600</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &quot;constructor&quot; instantiates the entire interface. It starts the operational threads for the serial</span>
<span class="sd">        interface as well as for the command handler.</span>

<span class="sd">        :param port_id: Communications port specifier (COM3, /dev/ttyACM0, etc)</span>

<span class="sd">        :param bluetooth: Sets start up delays for bluetooth connectivity. Set to False for faster start up.</span>

<span class="sd">        :param verbose: If set to False, the status print statements are suppressed.</span>

<span class="sd">        :param baud_rate: Set serial baud rate. Must match that of Firmata sketch on Arduino</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Currently only serial communication over USB is supported, but in the future</span>
        <span class="c1"># wifi and other transport mechanism support is anticipated</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">baud_rate</span> <span class="o">=</span> <span class="n">baud_rate</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># save the user&#39;s request if specified</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>


            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Python Version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">PyMata version 2.18  Copyright(C) 2013-18 Alan Yorinks    All rights reserved.&#39;</span><span class="p">)</span>

            <span class="c1"># Instantiate the serial support class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">PyMataSerial</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_deque</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baud_rate</span><span class="p">)</span>

            <span class="c1"># wait for HC-06 Bluetooth slave to initialize in case it is being used.</span>
            <span class="k">if</span> <span class="n">bluetooth</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="c1"># Attempt opening communications with the Arduino micro-controller</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

            <span class="c1"># additional wait for HC-06 if it is being used</span>
            <span class="k">if</span> <span class="n">bluetooth</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># necessary to support Arduino Mega</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Start the data receive thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># Instantiate the command handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span> <span class="o">=</span> <span class="n">PyMataCommandHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>

            <span class="c1">########################################################################</span>
            <span class="c1"># constants defined locally from values contained in the command handler</span>
            <span class="c1">########################################################################</span>

            <span class="c1"># Data latch state constants to be used when accessing data returned from get_latch_data methods.</span>
            <span class="c1"># The get_latch data methods return [pin_number, latch_state, latched_data, time_stamp]</span>
            <span class="c1"># These three constants define possible values for the second item in the list, latch_state</span>

            <span class="c1"># this pin will be ignored for latching - table initialized with this value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_IGNORE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_IGNORE</span>
            <span class="c1"># When the next pin value change is received for this pin, if it matches the latch criteria</span>
            <span class="c1"># the data will be latched.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_ARMED</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_ARMED</span>
            <span class="c1"># Data has been latched. Read the data to re-arm the latch.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_LATCHED</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_LATCHED</span>

            <span class="c1">#</span>
            <span class="c1"># These constants are used when setting a data latch.</span>
            <span class="c1"># Latch threshold types</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span>

            <span class="c1"># constants to be used to parse the data returned from calling</span>
            <span class="c1"># get_X_latch_data()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_PIN</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_STATE</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCHED_DATA</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LATCHED_TIME_STAMP</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="c1"># Start the command processing thread</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="c1"># Command handler should now be prepared to receive replies from the Arduino, so go ahead</span>
            <span class="c1"># detect the Arduino board</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please wait while Arduino is being detected. This can take up to 30 seconds ...&#39;</span><span class="p">)</span>

            <span class="c1"># perform board auto discovery</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">auto_discover_board</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
                <span class="c1"># board was not found so shutdown</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Board Auto Discovery Failed!, Shutting Down&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Program Aborted Before PyMata Instantiated&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">analog_mapping_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send an analog mapping query message via sysex. Client retrieves the results with a</span>
<span class="sd">        call to get_analog_mapping_request_results()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MAPPING_QUERY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">analog_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the last analog data value received for the specified pin.</span>

<span class="sd">        :param pin: Selected pin</span>

<span class="sd">        :return: The last value entered into the analog response table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_PIN_DATA_VALUE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">analog_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the specified pin to the specified value.</span>

<span class="sd">        :param pin: Pin number</span>

<span class="sd">        :param value: Pin value</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MESSAGE</span> <span class="o">+</span> <span class="n">pin</span> <span class="o">&lt;</span> <span class="mh">0xf0</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MESSAGE</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extended_analog</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">capability_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a Firmata capability query message via sysex. Client retrieves the results with a</span>
<span class="sd">        call to get_capability_query_results()</span>
<span class="sd">        The Arduino can be rather slow in responding to this command. For </span>
<span class="sd">        the Mega 2560 R3 it has taken up to 25 seconds for a response.   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">CAPABILITY_QUERY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will close the transport (serial port) and exit</span>
<span class="sd">        :return: No return value, but sys.exit(0) is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;PyMata close(): Calling sys.exit(0): Hope to see you soon!&quot;</span><span class="p">)</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">digital_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the last digital data value received for the specified pin.</span>
<span class="sd">        NOTE: This command will return values for digital, pwm, etc,  pin types</span>

<span class="sd">        :param pin: Selected pin</span>

<span class="sd">        :return: The last value entered into the digital response table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_PIN_DATA_VALUE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>


    <span class="k">def</span> <span class="nf">digital_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the specified pin to the specified value.</span>

<span class="sd">        :param pin: pin number</span>

<span class="sd">        :param value: pin value</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The command value is not a fixed value, but needs to be calculated using the</span>
        <span class="c1"># pin&#39;s port number</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>

        <span class="n">calculated_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_MESSAGE</span> <span class="o">+</span> <span class="n">port</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">pin</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c1"># Calculate the value for the pin&#39;s position in the port mask</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">|=</span> <span class="n">mask</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span>

        <span class="c1"># Assemble the command</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="n">calculated_command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">disable_analog_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables analog reporting for a single analog pin.</span>

<span class="sd">        :param pin: Analog pin number. For example for A0, the number is 0.</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_ANALOG</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_DISABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">disable_digital_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables digital reporting. By turning reporting off for this pin, reporting</span>
<span class="sd">        is disabled for all 8 bits in the &quot;port&quot; -</span>

<span class="sd">        :param pin: Pin and all pins for this port</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_DIGITAL</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_DISABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">enable_analog_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables analog reporting. By turning reporting on for a single pin.</span>

<span class="sd">        :param pin: Analog pin number. For example for A0, the number is 0.</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_ANALOG</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_ENABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">enable_digital_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables digital reporting. By turning reporting on for all 8 bits in the &quot;port&quot; -</span>
<span class="sd">        this is part of Firmata&#39;s protocol specification.</span>

<span class="sd">        :param pin: Pin and all pins for this port</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_DIGITAL</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_ENABLE</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">encoder_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin_a</span><span class="p">,</span> <span class="n">pin_b</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This command enables the rotary encoder (2 pin + ground) and will</span>
<span class="sd">        enable encoder reporting.</span>

<span class="sd">        NOTE: This command is not currently part of standard arduino firmata, but is provided for legacy</span>
<span class="sd">        support of CodeShield on an Arduino UNO.</span>

<span class="sd">        Encoder data is retrieved by performing a digital_read from pin a (encoder pin 1)</span>

<span class="sd">        :param pin_a: Encoder pin 1.</span>

<span class="sd">        :param pin_b: Encoder pin 2.</span>

<span class="sd">        :param cb: callback function to report encoder changes</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin_a</span><span class="p">,</span> <span class="n">pin_b</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCODER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin_a</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCODER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin_b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ENCODER_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">extended_analog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will send an extended data analog output command to the selected pin</span>

<span class="sd">        :param pin: 0 - 127</span>

<span class="sd">        :param data: 0 - 0xfffff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analog_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin</span><span class="p">,</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">EXTENDED_ANALOG</span><span class="p">,</span> <span class="n">analog_data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_analog_latch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list is returned containing the latch state for the pin, the latched value, and the time stamp</span>
<span class="sd">        [pin_num, latch_state, latched_value, time_stamp]</span>
<span class="sd">        If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</span>

<span class="sd">        :param pin: Pin number.</span>

<span class="sd">        :return: [pin, latch_state, latch_data_value, time_stamp]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_analog_latch_data</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_analog_mapping_request_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method after calling analog_mapping_query() to retrieve its results</span>
<span class="sd">        :return: raw data returned by firmata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_mapping_query_results</span>


    <span class="k">def</span> <span class="nf">get_analog_response_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of lists representing the current pin mode and</span>
<span class="sd">        associated data values for all analog pins.</span>
<span class="sd">        All configured pin types, both input and output will be listed. Output pin data will contain zero.</span>
<span class="sd">        :return: The last update of the digital response table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_analog_response_table</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">get_capability_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the data returned by a previous call to capability_query()</span>
<span class="sd">        :return: Raw capability data returned by firmata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">capability_query_results</span>


    <span class="k">def</span> <span class="nf">get_digital_latch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list is returned containing the latch state for the pin, the latched value, and the time stamp</span>
<span class="sd">        [pin_num, latch_state, latched_value, time_stamp]</span>
<span class="sd">        If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</span>

<span class="sd">        :param pin: Pin number.</span>

<span class="sd">        :return: [pin, latch_state, latch_data_value, time_stamp]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_digital_latch_data</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_digital_response_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns a list of lists representing the current pin mode</span>
<span class="sd">        and associated data for all digital pins.</span>
<span class="sd">        All pin types, both input and output will be listed. Output pin data will contain zero.</span>
<span class="sd">        :return: The last update of the digital response table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_digital_response_table</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">get_firmata_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the firmata version information returned by a previous call to refresh_report_version()</span>
<span class="sd">        :return: Firmata_version list [major, minor] or None</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">firmata_version</span>


    <span class="k">def</span> <span class="nf">get_firmata_firmware_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the firmware id information returned by a previous call to refresh_report_firmware()</span>
<span class="sd">        :return: Firmata_firmware  list [major, minor, file_name] or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">firmata_firmware</span>


    <span class="k">def</span> <span class="nf">get_pin_state_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the results of a previous call to pin_state_query() and then resets</span>
<span class="sd">        the pin state query data to None</span>

<span class="sd">        :return: Raw pin state query data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">last_pin_query_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">last_pin_query_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">r_data</span>


    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">get_pymata_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the PyMata version number in a list: [Major Number, Minor Number]</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">]</span>


    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">get_sonar_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve Ping (HC-SR04 type) data. The data is presented as a dictionary.</span>
<span class="sd">        The &#39;key&#39; is the trigger pin specified in sonar_config() and the &#39;data&#39; is the</span>
<span class="sd">        current measured distance (in centimeters)</span>
<span class="sd">        for that pin. If there is no data, the value is set to IGNORE (127).</span>

<span class="sd">        :return: active_sonar_map</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span>


    <span class="k">def</span> <span class="nf">get_stepper_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the stepper library version number.</span>

<span class="sd">        :param timeout: specify a time to allow arduino to process and return a version</span>

<span class="sd">        :return: the stepper version number if it was set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current time</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># wait for up to 20 seconds for a successful capability query to occur</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stepper_library_version</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Stepper Library Version Request timed-out. &quot;</span>
                          <span class="s2">&quot;Did you send a stepper_request_library_version command?&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stepper_library_version</span>


    <span class="k">def</span> <span class="nf">i2c_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read_delay_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clk_pin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_pin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOTE: THIS METHOD MUST BE CALLED BEFORE ANY I2C REQUEST IS MADE</span>
<span class="sd">        This method initializes Firmata for I2c operations.</span>
<span class="sd">        It allows setting of a read time delay amount, and to optionally track</span>
<span class="sd">        the pins as I2C in the appropriate response table.</span>
<span class="sd">        To track pins: Set the pin_type to ANALOG or DIGITAL and provide the pin numbers.</span>
<span class="sd">        If using ANALOG, pin numbers use the analog number, for example A4: use 4.</span>

<span class="sd">        :param read_delay_time: an optional parameter, default is 0</span>

<span class="sd">        :param pin_type: ANALOG or DIGITAL to select response table type to track pin numbers</span>

<span class="sd">        :param clk_pin: pin number (see comment above).</span>

<span class="sd">        :param data_pin: pin number (see comment above).</span>

<span class="sd">        :return: No Return Value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_delay_time</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">read_delay_time</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># If pin type is set, set pin mode in appropriate response table for these pins</span>
        <span class="k">if</span> <span class="n">pin_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">clk_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">data_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">clk_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">data_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>


    <span class="k">def</span> <span class="nf">i2c_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">number_of_bytes</span><span class="p">,</span> <span class="n">read_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method requests the read of an i2c device. Results are retrieved by a call to</span>
<span class="sd">        i2c_get_read_data().</span>
<span class="sd">        If a callback method is provided, when data is received from the device it will be sent to the callback method</span>

<span class="sd">        :param address: i2c device address</span>

<span class="sd">        :param register: register number (can be set to zero)</span>

<span class="sd">        :param number_of_bytes: number of bytes expected to be returned</span>

<span class="sd">        :param read_type: I2C_READ  or I2C_READ_CONTINUOUSLY</span>

<span class="sd">        :param cb: Optional callback function to report i2c data as result of read command</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="n">read_type</span><span class="p">,</span> <span class="n">register</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">register</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                <span class="n">number_of_bytes</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_bytes</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>

        <span class="c1"># add or update entry in i2c_map for reply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cb</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">i2c_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write data to an i2c device.</span>

<span class="sd">        :param address: i2c device address</span>

<span class="sd">        :param args: A variable number of bytes to be sent to the device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C_WRITE</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">i2c_stop_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method stops an I2C_READ_CONTINUOUSLY operation for the i2c device address specified.</span>

<span class="sd">        :param address: address of i2c device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C_STOP_READING</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">i2c_get_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method retrieves the i2c read data as the result of an i2c_read() command.</span>

<span class="sd">        :param address: i2c device address</span>

<span class="sd">        :return: raw data read from device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">:</span>
            <span class="n">map_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">[</span><span class="n">address</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">map_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">pin_state_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method issues a pin state query command. Data returned is retrieved via</span>
<span class="sd">        a call to get_pin_state_query_results()</span>
<span class="sd">        :param pin: pin number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">PIN_STATE_QUERY</span><span class="p">,</span> <span class="p">[</span><span class="n">pin</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">play_tone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">tone_command</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will call the Tone library for the selected pin.</span>
<span class="sd">        If the tone command is set to TONE_TONE, then the specified tone will be played.</span>
<span class="sd">        Else, if the tone command is TONE_NO_TONE, then any currently playing tone will be disabled.</span>
<span class="sd">        It is intended for a future release of Arduino Firmata</span>

<span class="sd">        :param pin: Pin number</span>

<span class="sd">        :param tone_command: Either TONE_TONE, or TONE_NO_TONE</span>

<span class="sd">        :param frequency: Frequency of tone</span>

<span class="sd">        :param duration: Duration of tone in milliseconds</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># convert the integer values to bytes</span>
        <span class="k">if</span> <span class="n">tone_command</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TONE_TONE</span><span class="p">:</span>
            <span class="c1"># duration is specified</span>
            <span class="k">if</span> <span class="n">duration</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">frequency</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="n">duration</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">frequency</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">TONE</span>
        <span class="c1"># turn off tone</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">TONE_PLAY</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">refresh_report_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will query firmata for the report version.</span>
<span class="sd">        Retrieve the report version via a call to get_firmata_version()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_VERSION</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">refresh_report_firmware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will query firmata to report firmware. Retrieve the report via a</span>
<span class="sd">        call to get_firmata_firmware_version()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_FIRMWARE</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This command sends a reset message to the Arduino. The response tables will be reinitialized</span>
<span class="sd">        :return: No return value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set all output pins to a value of 0</span>
        <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">total_pins_discovered</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVO</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TONE</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TONE_NO_TONE</span><span class="p">,</span> <span class="n">pin</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">TONE_PLAY</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">set_analog_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method &quot;arms&quot; an analog pin for its data to be latched and saved in the latching table</span>
<span class="sd">        If a callback method is provided, when latching criteria is achieved, the callback function is called</span>
<span class="sd">        with latching data notification. In that case, the latching table is not updated.</span>

<span class="sd">        :param pin: Analog pin number (value following an &#39;A&#39; designator, i.e. A5 = 5</span>

<span class="sd">        :param threshold_type: ANALOG_LATCH_GT | ANALOG_LATCH_LT  | ANALOG_LATCH_GTE | ANALOG_LATCH_LTE</span>

<span class="sd">        :param threshold_value: numerical value - between 0 and 1023</span>

<span class="sd">        :param cb: callback method</span>

<span class="sd">        :return: True if successful, False if parameter data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span> <span class="o">&lt;=</span> <span class="n">threshold_type</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">threshold_value</span> <span class="o">&lt;=</span> <span class="mi">1023</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">set_analog_latch</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">set_digital_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method &quot;arms&quot; a digital pin for its data to be latched and saved in the latching table</span>
<span class="sd">        If a callback method is provided, when latching criteria is achieved, the callback function is called</span>
<span class="sd">        with latching data notification. In that case, the latching table is not updated.</span>

<span class="sd">        :param pin: Digital pin number</span>

<span class="sd">        :param threshold_type: DIGITAL_LATCH_HIGH | DIGITAL_LATCH_LOW</span>

<span class="sd">        :param cb: callback function</span>

<span class="sd">        :return: True if successful, False if parameter data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">threshold_type</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">set_digital_latch</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">set_pin_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">pin_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets a pin to the desired pin mode for the pin_type.</span>
<span class="sd">        It automatically enables data reporting.</span>
<span class="sd">        NOTE: DO NOT CALL THIS METHOD FOR I2C. See i2c_config().</span>

<span class="sd">        :param pin: Pin number (for analog use the analog number, for example A4: use 4)</span>

<span class="sd">        :param mode: INPUT, OUTPUT, PWM, PULLUP</span>

<span class="sd">        :param pin_type: ANALOG or DIGITAL</span>

<span class="sd">        :param cb: This is an optional callback function to report data changes to the user</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SET_PIN_MODE</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># enable reporting for input pins</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PULLUP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">:</span>

                <span class="c1"># set analog response table to show this pin is an input pin</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_analog_reporting</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
            <span class="c1"># if not analog it has to be digital</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># must be output - so set the tables accordingly</span>
            <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>


    <span class="k">def</span> <span class="nf">set_sampling_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sends the desired sampling interval to Firmata.</span>
<span class="sd">        Note: Standard Firmata  will ignore any interval less than 10 milliseconds</span>

<span class="sd">        :param interval: Integer value for desired sampling interval in milliseconds</span>

<span class="sd">        :return: No return value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">interval</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">interval</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SAMPLING_INTERVAL</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">servo_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">min_pulse</span><span class="o">=</span><span class="mi">544</span><span class="p">,</span> <span class="n">max_pulse</span><span class="o">=</span><span class="mi">2400</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure a pin as a servo pin. Set pulse min, max in ms.</span>

<span class="sd">        :param pin: Servo Pin.</span>

<span class="sd">        :param min_pulse: Min pulse width in ms.</span>

<span class="sd">        :param max_pulse: Max pulse width in ms.</span>

<span class="sd">        :return: No return value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin</span><span class="p">,</span> <span class="n">min_pulse</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">min_pulse</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                   <span class="n">max_pulse</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">max_pulse</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SERVO_CONFIG</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">sonar_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trigger_pin</span><span class="p">,</span> <span class="n">echo_pin</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ping_interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure the pins,ping interval and maximum distance for an HC-SR04 type device.</span>
<span class="sd">        Single pin configuration may be used. To do so, set both the trigger and echo pins to the same value.</span>
<span class="sd">        Up to a maximum of 6 SONAR devices is supported</span>
<span class="sd">        If the maximum is exceeded a message is sent to the console and the request is ignored.</span>
<span class="sd">        NOTE: data is measured in centimeters</span>

<span class="sd">        :param trigger_pin: The pin number of for the trigger (transmitter).</span>

<span class="sd">        :param echo_pin: The pin number for the received echo.</span>

<span class="sd">        :param ping_interval: Minimum interval between pings. Lowest number to use is 33 ms.Max is 127</span>

<span class="sd">        :param max_distance: Maximum distance in cm. Max is 200.</span>

<span class="sd">        :param cb: optional callback function to report sonar data changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_distance</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">max_distance</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="n">max_distance_lsb</span> <span class="o">=</span> <span class="n">max_distance</span> <span class="o">&amp;</span> <span class="mh">0x7f</span>
        <span class="n">max_distance_msb</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_distance</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">trigger_pin</span><span class="p">,</span> <span class="n">echo_pin</span><span class="p">,</span> <span class="n">ping_interval</span><span class="p">,</span> <span class="n">max_distance_lsb</span><span class="p">,</span> <span class="n">max_distance_msb</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">trigger_pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">echo_pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
        <span class="c1"># update the ping data map for this pin</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sonar_config: maximum number of devices assigned - ignoring request&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>

                <span class="c1"># self._command_handler.active_sonar_map[trigger_pin] = self.IGNORE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span><span class="p">[</span><span class="n">trigger_pin</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cb</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SONAR_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stepper_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps_per_revolution</span><span class="p">,</span> <span class="n">stepper_pins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure stepper motor prior to operation.</span>

<span class="sd">        :param steps_per_revolution: number of steps per motor revolution</span>

<span class="sd">        :param stepper_pins: a list of control pin numbers - either 4 or 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_CONFIGURE</span><span class="p">,</span> <span class="n">steps_per_revolution</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">steps_per_revolution</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stepper_pins</span><span class="p">)):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stepper_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stepper_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor_speed</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move a stepper motor for the number of steps at the specified speed</span>

<span class="sd">        :param motor_speed: 21 bits of data to set motor speed</span>

<span class="sd">        :param number_of_steps: 14 bits for number of steps &amp; direction</span>
<span class="sd">                                positive is forward, negative is reverse</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">number_of_steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">abs_number_of_steps</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_STEP</span><span class="p">,</span> <span class="n">motor_speed</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">motor_speed</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">motor_speed</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                <span class="n">abs_number_of_steps</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">abs_number_of_steps</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="n">direction</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stepper_request_library_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request the stepper library version from the Arduino.</span>
<span class="sd">        To retrieve the version after this command is called, call</span>
<span class="sd">        get_stepper_version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_LIBRARY_VERSION</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#PyMata.pymata.PyMata">PyMata</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="PyMata.pymata.PyMata.ANALOG" class="name">var <span class="ident">ANALOG</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.DIGITAL" class="name">var <span class="ident">DIGITAL</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.ENCODER" class="name">var <span class="ident">ENCODER</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.HIGH" class="name">var <span class="ident">HIGH</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.I2C" class="name">var <span class="ident">I2C</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.I2C_READ" class="name">var <span class="ident">I2C_READ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.I2C_READ_CONTINUOUSLY" class="name">var <span class="ident">I2C_READ_CONTINUOUSLY</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.I2C_READ_WRITE_MODE_MASK" class="name">var <span class="ident">I2C_READ_WRITE_MODE_MASK</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.I2C_STOP_READING" class="name">var <span class="ident">I2C_STOP_READING</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.I2C_WRITE" class="name">var <span class="ident">I2C_WRITE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.IGNORE" class="name">var <span class="ident">IGNORE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.INPUT" class="name">var <span class="ident">INPUT</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.LATCH_MODE" class="name">var <span class="ident">LATCH_MODE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.LOW" class="name">var <span class="ident">LOW</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.ONEWIRE" class="name">var <span class="ident">ONEWIRE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.OUTPUT" class="name">var <span class="ident">OUTPUT</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.PULLUP" class="name">var <span class="ident">PULLUP</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.PWM" class="name">var <span class="ident">PWM</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.REPORTING_DISABLE" class="name">var <span class="ident">REPORTING_DISABLE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.REPORTING_ENABLE" class="name">var <span class="ident">REPORTING_ENABLE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.SERIAL" class="name">var <span class="ident">SERIAL</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.SERVO" class="name">var <span class="ident">SERVO</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.SONAR" class="name">var <span class="ident">SONAR</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.STEPPER" class="name">var <span class="ident">STEPPER</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.STEPPER_CONFIGURE" class="name">var <span class="ident">STEPPER_CONFIGURE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.STEPPER_LIBRARY_VERSION" class="name">var <span class="ident">STEPPER_LIBRARY_VERSION</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.STEPPER_STEP" class="name">var <span class="ident">STEPPER_STEP</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.TONE" class="name">var <span class="ident">TONE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.TONE_NO_TONE" class="name">var <span class="ident">TONE_NO_TONE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.TONE_TONE" class="name">var <span class="ident">TONE_TONE</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.arduino" class="name">var <span class="ident">arduino</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.command_deque" class="name">var <span class="ident">command_deque</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.data_lock" class="name">var <span class="ident">data_lock</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.digital_output_port_pins" class="name">var <span class="ident">digital_output_port_pins</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="PyMata.pymata.PyMata.verbose" class="name">var <span class="ident">verbose</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, port_id=&#39;/dev/ttyACM0&#39;, bluetooth=True, verbose=True, baud_rate=57600)</p>
    </div>
    

    
  
    <div class="desc"><p>The "constructor" instantiates the entire interface. It starts the operational threads for the serial
interface as well as for the command handler.</p>
<p>:param port_id: Communications port specifier (COM3, /dev/ttyACM0, etc)</p>
<p>:param bluetooth: Sets start up delays for bluetooth connectivity. Set to False for faster start up.</p>
<p>:param verbose: If set to False, the status print statements are suppressed.</p>
<p>:param baud_rate: Set serial baud rate. Must match that of Firmata sketch on Arduino</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.__init__', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="o">=</span><span class="s1">&#39;/dev/ttyACM0&#39;</span><span class="p">,</span> <span class="n">bluetooth</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">baud_rate</span><span class="o">=</span><span class="mi">57600</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &quot;constructor&quot; instantiates the entire interface. It starts the operational threads for the serial</span>
<span class="sd">    interface as well as for the command handler.</span>
<span class="sd">    :param port_id: Communications port specifier (COM3, /dev/ttyACM0, etc)</span>
<span class="sd">    :param bluetooth: Sets start up delays for bluetooth connectivity. Set to False for faster start up.</span>
<span class="sd">    :param verbose: If set to False, the status print statements are suppressed.</span>
<span class="sd">    :param baud_rate: Set serial baud rate. Must match that of Firmata sketch on Arduino</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Currently only serial communication over USB is supported, but in the future</span>
    <span class="c1"># wifi and other transport mechanism support is anticipated</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">baud_rate</span> <span class="o">=</span> <span class="n">baud_rate</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># save the user&#39;s request if specified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Python Version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">PyMata version 2.18  Copyright(C) 2013-18 Alan Yorinks    All rights reserved.&#39;</span><span class="p">)</span>
        <span class="c1"># Instantiate the serial support class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">PyMataSerial</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_deque</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baud_rate</span><span class="p">)</span>
        <span class="c1"># wait for HC-06 Bluetooth slave to initialize in case it is being used.</span>
        <span class="k">if</span> <span class="n">bluetooth</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1"># Attempt opening communications with the Arduino micro-controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># additional wait for HC-06 if it is being used</span>
        <span class="k">if</span> <span class="n">bluetooth</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># necessary to support Arduino Mega</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Start the data receive thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="c1"># Instantiate the command handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span> <span class="o">=</span> <span class="n">PyMataCommandHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>
        <span class="c1">########################################################################</span>
        <span class="c1"># constants defined locally from values contained in the command handler</span>
        <span class="c1">########################################################################</span>
        <span class="c1"># Data latch state constants to be used when accessing data returned from get_latch_data methods.</span>
        <span class="c1"># The get_latch data methods return [pin_number, latch_state, latched_data, time_stamp]</span>
        <span class="c1"># These three constants define possible values for the second item in the list, latch_state</span>
        <span class="c1"># this pin will be ignored for latching - table initialized with this value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_IGNORE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_IGNORE</span>
        <span class="c1"># When the next pin value change is received for this pin, if it matches the latch criteria</span>
        <span class="c1"># the data will be latched.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_ARMED</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_ARMED</span>
        <span class="c1"># Data has been latched. Read the data to re-arm the latch.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_LATCHED</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">LATCH_LATCHED</span>
        <span class="c1">#</span>
        <span class="c1"># These constants are used when setting a data latch.</span>
        <span class="c1"># Latch threshold types</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span>
        <span class="c1"># constants to be used to parse the data returned from calling</span>
        <span class="c1"># get_X_latch_data()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_PIN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCH_STATE</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCHED_DATA</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LATCHED_TIME_STAMP</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c1"># Start the command processing thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="c1"># Command handler should now be prepared to receive replies from the Arduino, so go ahead</span>
        <span class="c1"># detect the Arduino board</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Please wait while Arduino is being detected. This can take up to 30 seconds ...&#39;</span><span class="p">)</span>
        <span class="c1"># perform board auto discovery</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">auto_discover_board</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="c1"># board was not found so shutdown</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Board Auto Discovery Failed!, Shutting Down&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Program Aborted Before PyMata Instantiated&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.analog_mapping_query">
    <p>def <span class="ident">analog_mapping_query</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Send an analog mapping query message via sysex. Client retrieves the results with a
call to get_analog_mapping_request_results()</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.analog_mapping_query', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.analog_mapping_query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">analog_mapping_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send an analog mapping query message via sysex. Client retrieves the results with a</span>
<span class="sd">    call to get_analog_mapping_request_results()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MAPPING_QUERY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.analog_read">
    <p>def <span class="ident">analog_read</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve the last analog data value received for the specified pin.</p>
<p>:param pin: Selected pin</p>
<p>:return: The last value entered into the analog response table.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.analog_read', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.analog_read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">analog_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the last analog data value received for the specified pin.</span>
<span class="sd">    :param pin: Selected pin</span>
<span class="sd">    :return: The last value entered into the analog response table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_PIN_DATA_VALUE</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.analog_write">
    <p>def <span class="ident">analog_write</span>(</p><p>self, pin, value)</p>
    </div>
    

    
  
    <div class="desc"><p>Set the specified pin to the specified value.</p>
<p>:param pin: Pin number</p>
<p>:param value: Pin value</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.analog_write', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.analog_write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">analog_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the specified pin to the specified value.</span>
<span class="sd">    :param pin: Pin number</span>
<span class="sd">    :param value: Pin value</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MESSAGE</span> <span class="o">+</span> <span class="n">pin</span> <span class="o">&lt;</span> <span class="mh">0xf0</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ANALOG_MESSAGE</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extended_analog</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.capability_query">
    <p>def <span class="ident">capability_query</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Send a Firmata capability query message via sysex. Client retrieves the results with a
call to get_capability_query_results()
The Arduino can be rather slow in responding to this command. For 
the Mega 2560 R3 it has taken up to 25 seconds for a response.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.capability_query', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.capability_query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">capability_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send a Firmata capability query message via sysex. Client retrieves the results with a</span>
<span class="sd">    call to get_capability_query_results()</span>
<span class="sd">    The Arduino can be rather slow in responding to this command. For </span>
<span class="sd">    the Mega 2560 R3 it has taken up to 25 seconds for a response.   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">CAPABILITY_QUERY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This method will close the transport (serial port) and exit
:return: No return value, but sys.exit(0) is called.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.close', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method will close the transport (serial port) and exit</span>
<span class="sd">    :return: No return value, but sys.exit(0) is called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;PyMata close(): Calling sys.exit(0): Hope to see you soon!&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.digital_read">
    <p>def <span class="ident">digital_read</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve the last digital data value received for the specified pin.
NOTE: This command will return values for digital, pwm, etc,  pin types</p>
<p>:param pin: Selected pin</p>
<p>:return: The last value entered into the digital response table.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.digital_read', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.digital_read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">digital_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the last digital data value received for the specified pin.</span>
<span class="sd">    NOTE: This command will return values for digital, pwm, etc,  pin types</span>
<span class="sd">    :param pin: Selected pin</span>
<span class="sd">    :return: The last value entered into the digital response table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_PIN_DATA_VALUE</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.digital_write">
    <p>def <span class="ident">digital_write</span>(</p><p>self, pin, value)</p>
    </div>
    

    
  
    <div class="desc"><p>Set the specified pin to the specified value.</p>
<p>:param pin: pin number</p>
<p>:param value: pin value</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.digital_write', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.digital_write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">digital_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the specified pin to the specified value.</span>
<span class="sd">    :param pin: pin number</span>
<span class="sd">    :param value: pin value</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The command value is not a fixed value, but needs to be calculated using the</span>
    <span class="c1"># pin&#39;s port number</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
    <span class="n">calculated_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">DIGITAL_MESSAGE</span> <span class="o">+</span> <span class="n">port</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">pin</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)</span>
    <span class="c1"># Calculate the value for the pin&#39;s position in the port mask</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">|=</span> <span class="n">mask</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span>
    <span class="c1"># Assemble the command</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="n">calculated_command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digital_output_port_pins</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.disable_analog_reporting">
    <p>def <span class="ident">disable_analog_reporting</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>Disables analog reporting for a single analog pin.</p>
<p>:param pin: Analog pin number. For example for A0, the number is 0.</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.disable_analog_reporting', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.disable_analog_reporting" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">disable_analog_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disables analog reporting for a single analog pin.</span>
<span class="sd">    :param pin: Analog pin number. For example for A0, the number is 0.</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_ANALOG</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_DISABLE</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.disable_digital_reporting">
    <p>def <span class="ident">disable_digital_reporting</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>Disables digital reporting. By turning reporting off for this pin, reporting
is disabled for all 8 bits in the "port" -</p>
<p>:param pin: Pin and all pins for this port</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.disable_digital_reporting', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.disable_digital_reporting" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">disable_digital_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disables digital reporting. By turning reporting off for this pin, reporting</span>
<span class="sd">    is disabled for all 8 bits in the &quot;port&quot; -</span>
<span class="sd">    :param pin: Pin and all pins for this port</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_DIGITAL</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_DISABLE</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.enable_analog_reporting">
    <p>def <span class="ident">enable_analog_reporting</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>Enables analog reporting. By turning reporting on for a single pin.</p>
<p>:param pin: Analog pin number. For example for A0, the number is 0.</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.enable_analog_reporting', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.enable_analog_reporting" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">enable_analog_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enables analog reporting. By turning reporting on for a single pin.</span>
<span class="sd">    :param pin: Analog pin number. For example for A0, the number is 0.</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_ANALOG</span> <span class="o">+</span> <span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_ENABLE</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.enable_digital_reporting">
    <p>def <span class="ident">enable_digital_reporting</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>Enables digital reporting. By turning reporting on for all 8 bits in the "port" -
this is part of Firmata's protocol specification.</p>
<p>:param pin: Pin and all pins for this port</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.enable_digital_reporting', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.enable_digital_reporting" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">enable_digital_reporting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enables digital reporting. By turning reporting on for all 8 bits in the &quot;port&quot; -</span>
<span class="sd">    this is part of Firmata&#39;s protocol specification.</span>
<span class="sd">    :param pin: Pin and all pins for this port</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">//</span> <span class="mi">8</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_DIGITAL</span> <span class="o">+</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPORTING_ENABLE</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.encoder_config">
    <p>def <span class="ident">encoder_config</span>(</p><p>self, pin_a, pin_b, cb=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This command enables the rotary encoder (2 pin + ground) and will
enable encoder reporting.</p>
<p>NOTE: This command is not currently part of standard arduino firmata, but is provided for legacy
support of CodeShield on an Arduino UNO.</p>
<p>Encoder data is retrieved by performing a digital_read from pin a (encoder pin 1)</p>
<p>:param pin_a: Encoder pin 1.</p>
<p>:param pin_b: Encoder pin 2.</p>
<p>:param cb: callback function to report encoder changes</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.encoder_config', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.encoder_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">encoder_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin_a</span><span class="p">,</span> <span class="n">pin_b</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This command enables the rotary encoder (2 pin + ground) and will</span>
<span class="sd">    enable encoder reporting.</span>
<span class="sd">    NOTE: This command is not currently part of standard arduino firmata, but is provided for legacy</span>
<span class="sd">    support of CodeShield on an Arduino UNO.</span>
<span class="sd">    Encoder data is retrieved by performing a digital_read from pin a (encoder pin 1)</span>
<span class="sd">    :param pin_a: Encoder pin 1.</span>
<span class="sd">    :param pin_b: Encoder pin 2.</span>
<span class="sd">    :param cb: callback function to report encoder changes</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin_a</span><span class="p">,</span> <span class="n">pin_b</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCODER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin_a</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ENCODER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin_b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin_b</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">ENCODER_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.extended_analog">
    <p>def <span class="ident">extended_analog</span>(</p><p>self, pin, data)</p>
    </div>
    

    
  
    <div class="desc"><p>This method will send an extended data analog output command to the selected pin</p>
<p>:param pin: 0 - 127</p>
<p>:param data: 0 - 0xfffff</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.extended_analog', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.extended_analog" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extended_analog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method will send an extended data analog output command to the selected pin</span>
<span class="sd">    :param pin: 0 - 127</span>
<span class="sd">    :param data: 0 - 0xfffff</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analog_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin</span><span class="p">,</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">EXTENDED_ANALOG</span><span class="p">,</span> <span class="n">analog_data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_analog_latch_data">
    <p>def <span class="ident">get_analog_latch_data</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>A list is returned containing the latch state for the pin, the latched value, and the time stamp
[pin_num, latch_state, latched_value, time_stamp]
If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</p>
<p>:param pin: Pin number.</p>
<p>:return: [pin, latch_state, latch_data_value, time_stamp]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_analog_latch_data', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_analog_latch_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_analog_latch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list is returned containing the latch state for the pin, the latched value, and the time stamp</span>
<span class="sd">    [pin_num, latch_state, latched_value, time_stamp]</span>
<span class="sd">    If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</span>
<span class="sd">    :param pin: Pin number.</span>
<span class="sd">    :return: [pin, latch_state, latch_data_value, time_stamp]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_analog_latch_data</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_analog_mapping_request_results">
    <p>def <span class="ident">get_analog_mapping_request_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Call this method after calling analog_mapping_query() to retrieve its results
:return: raw data returned by firmata</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_analog_mapping_request_results', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_analog_mapping_request_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_analog_mapping_request_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call this method after calling analog_mapping_query() to retrieve its results</span>
<span class="sd">    :return: raw data returned by firmata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_mapping_query_results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_analog_response_table">
    <p>def <span class="ident">get_analog_response_table</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This method returns a list of lists representing the current pin mode and
associated data values for all analog pins.
All configured pin types, both input and output will be listed. Output pin data will contain zero.
:return: The last update of the digital response table</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_analog_response_table', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_analog_response_table" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_analog_response_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method returns a list of lists representing the current pin mode and</span>
<span class="sd">    associated data values for all analog pins.</span>
<span class="sd">    All configured pin types, both input and output will be listed. Output pin data will contain zero.</span>
<span class="sd">    :return: The last update of the digital response table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_analog_response_table</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_capability_query_results">
    <p>def <span class="ident">get_capability_query_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve the data returned by a previous call to capability_query()
:return: Raw capability data returned by firmata</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_capability_query_results', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_capability_query_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_capability_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the data returned by a previous call to capability_query()</span>
<span class="sd">    :return: Raw capability data returned by firmata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">capability_query_results</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_digital_latch_data">
    <p>def <span class="ident">get_digital_latch_data</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>A list is returned containing the latch state for the pin, the latched value, and the time stamp
[pin_num, latch_state, latched_value, time_stamp]
If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</p>
<p>:param pin: Pin number.</p>
<p>:return: [pin, latch_state, latch_data_value, time_stamp]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_digital_latch_data', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_digital_latch_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_digital_latch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list is returned containing the latch state for the pin, the latched value, and the time stamp</span>
<span class="sd">    [pin_num, latch_state, latched_value, time_stamp]</span>
<span class="sd">    If the the latch state is LATCH_LATCHED, the table is reset (data and timestamp set to zero)</span>
<span class="sd">    :param pin: Pin number.</span>
<span class="sd">    :return: [pin, latch_state, latch_data_value, time_stamp]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_digital_latch_data</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_digital_response_table">
    <p>def <span class="ident">get_digital_response_table</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This method returns a list of lists representing the current pin mode
and associated data for all digital pins.
All pin types, both input and output will be listed. Output pin data will contain zero.
:return: The last update of the digital response table</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_digital_response_table', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_digital_response_table" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_digital_response_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method returns a list of lists representing the current pin mode</span>
<span class="sd">    and associated data for all digital pins.</span>
<span class="sd">    All pin types, both input and output will be listed. Output pin data will contain zero.</span>
<span class="sd">    :return: The last update of the digital response table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">get_digital_response_table</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_firmata_firmware_version">
    <p>def <span class="ident">get_firmata_firmware_version</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve the firmware id information returned by a previous call to refresh_report_firmware()
:return: Firmata_firmware  list [major, minor, file_name] or None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_firmata_firmware_version', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_firmata_firmware_version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_firmata_firmware_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the firmware id information returned by a previous call to refresh_report_firmware()</span>
<span class="sd">    :return: Firmata_firmware  list [major, minor, file_name] or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">firmata_firmware</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_firmata_version">
    <p>def <span class="ident">get_firmata_version</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve the firmata version information returned by a previous call to refresh_report_version()
:return: Firmata_version list [major, minor] or None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_firmata_version', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_firmata_version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_firmata_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the firmata version information returned by a previous call to refresh_report_version()</span>
<span class="sd">    :return: Firmata_version list [major, minor] or None</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">firmata_version</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_pin_state_query_results">
    <p>def <span class="ident">get_pin_state_query_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This method returns the results of a previous call to pin_state_query() and then resets
the pin state query data to None</p>
<p>:return: Raw pin state query data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_pin_state_query_results', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_pin_state_query_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_pin_state_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method returns the results of a previous call to pin_state_query() and then resets</span>
<span class="sd">    the pin state query data to None</span>
<span class="sd">    :return: Raw pin state query data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">last_pin_query_results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">last_pin_query_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">r_data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_pymata_version">
    <p>def <span class="ident">get_pymata_version</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the PyMata version number in a list: [Major Number, Minor Number]</p>
<p>:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_pymata_version', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_pymata_version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_pymata_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the PyMata version number in a list: [Major Number, Minor Number]</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_sonar_data">
    <p>def <span class="ident">get_sonar_data</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve Ping (HC-SR04 type) data. The data is presented as a dictionary.
The 'key' is the trigger pin specified in sonar_config() and the 'data' is the
current measured distance (in centimeters)
for that pin. If there is no data, the value is set to IGNORE (127).</p>
<p>:return: active_sonar_map</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_sonar_data', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_sonar_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_sonar_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve Ping (HC-SR04 type) data. The data is presented as a dictionary.</span>
<span class="sd">    The &#39;key&#39; is the trigger pin specified in sonar_config() and the &#39;data&#39; is the</span>
<span class="sd">    current measured distance (in centimeters)</span>
<span class="sd">    for that pin. If there is no data, the value is set to IGNORE (127).</span>
<span class="sd">    :return: active_sonar_map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.get_stepper_version">
    <p>def <span class="ident">get_stepper_version</span>(</p><p>self, timeout=20)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the stepper library version number.</p>
<p>:param timeout: specify a time to allow arduino to process and return a version</p>
<p>:return: the stepper version number if it was set.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.get_stepper_version', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.get_stepper_version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_stepper_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the stepper library version number.</span>
<span class="sd">    :param timeout: specify a time to allow arduino to process and return a version</span>
<span class="sd">    :return: the stepper version number if it was set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get current time</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c1"># wait for up to 20 seconds for a successful capability query to occur</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stepper_library_version</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Stepper Library Version Request timed-out. &quot;</span>
                      <span class="s2">&quot;Did you send a stepper_request_library_version command?&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">stepper_library_version</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.i2c_config">
    <p>def <span class="ident">i2c_config</span>(</p><p>self, read_delay_time=0, pin_type=None, clk_pin=0, data_pin=0)</p>
    </div>
    

    
  
    <div class="desc"><p>NOTE: THIS METHOD MUST BE CALLED BEFORE ANY I2C REQUEST IS MADE
This method initializes Firmata for I2c operations.
It allows setting of a read time delay amount, and to optionally track
the pins as I2C in the appropriate response table.
To track pins: Set the pin_type to ANALOG or DIGITAL and provide the pin numbers.
If using ANALOG, pin numbers use the analog number, for example A4: use 4.</p>
<p>:param read_delay_time: an optional parameter, default is 0</p>
<p>:param pin_type: ANALOG or DIGITAL to select response table type to track pin numbers</p>
<p>:param clk_pin: pin number (see comment above).</p>
<p>:param data_pin: pin number (see comment above).</p>
<p>:return: No Return Value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.i2c_config', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.i2c_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">i2c_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">read_delay_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clk_pin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_pin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NOTE: THIS METHOD MUST BE CALLED BEFORE ANY I2C REQUEST IS MADE</span>
<span class="sd">    This method initializes Firmata for I2c operations.</span>
<span class="sd">    It allows setting of a read time delay amount, and to optionally track</span>
<span class="sd">    the pins as I2C in the appropriate response table.</span>
<span class="sd">    To track pins: Set the pin_type to ANALOG or DIGITAL and provide the pin numbers.</span>
<span class="sd">    If using ANALOG, pin numbers use the analog number, for example A4: use 4.</span>
<span class="sd">    :param read_delay_time: an optional parameter, default is 0</span>
<span class="sd">    :param pin_type: ANALOG or DIGITAL to select response table type to track pin numbers</span>
<span class="sd">    :param clk_pin: pin number (see comment above).</span>
<span class="sd">    :param data_pin: pin number (see comment above).</span>
<span class="sd">    :return: No Return Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">read_delay_time</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">read_delay_time</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="c1"># If pin type is set, set pin mode in appropriate response table for these pins</span>
    <span class="k">if</span> <span class="n">pin_type</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">clk_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">data_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">clk_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">data_pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.i2c_get_read_data">
    <p>def <span class="ident">i2c_get_read_data</span>(</p><p>self, address)</p>
    </div>
    

    
  
    <div class="desc"><p>This method retrieves the i2c read data as the result of an i2c_read() command.</p>
<p>:param address: i2c device address</p>
<p>:return: raw data read from device</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.i2c_get_read_data', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.i2c_get_read_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">i2c_get_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method retrieves the i2c read data as the result of an i2c_read() command.</span>
<span class="sd">    :param address: i2c device address</span>
<span class="sd">    :return: raw data read from device</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">:</span>
        <span class="n">map_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">[</span><span class="n">address</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">map_entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.i2c_read">
    <p>def <span class="ident">i2c_read</span>(</p><p>self, address, register, number_of_bytes, read_type, cb=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This method requests the read of an i2c device. Results are retrieved by a call to
i2c_get_read_data().
If a callback method is provided, when data is received from the device it will be sent to the callback method</p>
<p>:param address: i2c device address</p>
<p>:param register: register number (can be set to zero)</p>
<p>:param number_of_bytes: number of bytes expected to be returned</p>
<p>:param read_type: I2C_READ  or I2C_READ_CONTINUOUSLY</p>
<p>:param cb: Optional callback function to report i2c data as result of read command</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.i2c_read', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.i2c_read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">i2c_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">number_of_bytes</span><span class="p">,</span> <span class="n">read_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method requests the read of an i2c device. Results are retrieved by a call to</span>
<span class="sd">    i2c_get_read_data().</span>
<span class="sd">    If a callback method is provided, when data is received from the device it will be sent to the callback method</span>
<span class="sd">    :param address: i2c device address</span>
<span class="sd">    :param register: register number (can be set to zero)</span>
<span class="sd">    :param number_of_bytes: number of bytes expected to be returned</span>
<span class="sd">    :param read_type: I2C_READ  or I2C_READ_CONTINUOUSLY</span>
<span class="sd">    :param cb: Optional callback function to report i2c data as result of read command</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="n">read_type</span><span class="p">,</span> <span class="n">register</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">register</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
            <span class="n">number_of_bytes</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">number_of_bytes</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
    <span class="c1"># add or update entry in i2c_map for reply</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">i2c_map</span><span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cb</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.i2c_stop_reading">
    <p>def <span class="ident">i2c_stop_reading</span>(</p><p>self, address)</p>
    </div>
    

    
  
    <div class="desc"><p>This method stops an I2C_READ_CONTINUOUSLY operation for the i2c device address specified.</p>
<p>:param address: address of i2c device</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.i2c_stop_reading', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.i2c_stop_reading" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">i2c_stop_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method stops an I2C_READ_CONTINUOUSLY operation for the i2c device address specified.</span>
<span class="sd">    :param address: address of i2c device</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C_STOP_READING</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.i2c_write">
    <p>def <span class="ident">i2c_write</span>(</p><p>self, address, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Write data to an i2c device.</p>
<p>:param address: i2c device address</p>
<p>:param args: A variable number of bytes to be sent to the device</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.i2c_write', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.i2c_write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">i2c_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write data to an i2c device.</span>
<span class="sd">    :param address: i2c device address</span>
<span class="sd">    :param args: A variable number of bytes to be sent to the device</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I2C_WRITE</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">I2C_REQUEST</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.pin_state_query">
    <p>def <span class="ident">pin_state_query</span>(</p><p>self, pin)</p>
    </div>
    

    
  
    <div class="desc"><p>This method issues a pin state query command. Data returned is retrieved via
a call to get_pin_state_query_results()
:param pin: pin number</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.pin_state_query', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.pin_state_query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pin_state_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method issues a pin state query command. Data returned is retrieved via</span>
<span class="sd">    a call to get_pin_state_query_results()</span>
<span class="sd">    :param pin: pin number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">PIN_STATE_QUERY</span><span class="p">,</span> <span class="p">[</span><span class="n">pin</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.play_tone">
    <p>def <span class="ident">play_tone</span>(</p><p>self, pin, tone_command, frequency, duration)</p>
    </div>
    

    
  
    <div class="desc"><p>This method will call the Tone library for the selected pin.
If the tone command is set to TONE_TONE, then the specified tone will be played.
Else, if the tone command is TONE_NO_TONE, then any currently playing tone will be disabled.
It is intended for a future release of Arduino Firmata</p>
<p>:param pin: Pin number</p>
<p>:param tone_command: Either TONE_TONE, or TONE_NO_TONE</p>
<p>:param frequency: Frequency of tone</p>
<p>:param duration: Duration of tone in milliseconds</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.play_tone', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.play_tone" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play_tone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">tone_command</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method will call the Tone library for the selected pin.</span>
<span class="sd">    If the tone command is set to TONE_TONE, then the specified tone will be played.</span>
<span class="sd">    Else, if the tone command is TONE_NO_TONE, then any currently playing tone will be disabled.</span>
<span class="sd">    It is intended for a future release of Arduino Firmata</span>
<span class="sd">    :param pin: Pin number</span>
<span class="sd">    :param tone_command: Either TONE_TONE, or TONE_NO_TONE</span>
<span class="sd">    :param frequency: Frequency of tone</span>
<span class="sd">    :param duration: Duration of tone in milliseconds</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert the integer values to bytes</span>
    <span class="k">if</span> <span class="n">tone_command</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TONE_TONE</span><span class="p">:</span>
        <span class="c1"># duration is specified</span>
        <span class="k">if</span> <span class="n">duration</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">frequency</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="n">duration</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">frequency</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">TONE</span>
    <span class="c1"># turn off tone</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">tone_command</span><span class="p">,</span> <span class="n">pin</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">TONE_PLAY</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.refresh_report_firmware">
    <p>def <span class="ident">refresh_report_firmware</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This method will query firmata to report firmware. Retrieve the report via a
call to get_firmata_firmware_version()</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.refresh_report_firmware', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.refresh_report_firmware" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">refresh_report_firmware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method will query firmata to report firmware. Retrieve the report via a</span>
<span class="sd">    call to get_firmata_firmware_version()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_FIRMWARE</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.refresh_report_version">
    <p>def <span class="ident">refresh_report_version</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This method will query firmata for the report version.
Retrieve the report version via a call to get_firmata_version()</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.refresh_report_version', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.refresh_report_version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">refresh_report_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method will query firmata for the report version.</span>
<span class="sd">    Retrieve the report version via a call to get_firmata_version()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">REPORT_VERSION</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.reset">
    <p>def <span class="ident">reset</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>This command sends a reset message to the Arduino. The response tables will be reinitialized
:return: No return value.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.reset', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.reset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This command sends a reset message to the Arduino. The response tables will be reinitialized</span>
<span class="sd">    :return: No return value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set all output pins to a value of 0</span>
    <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">total_pins_discovered</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PWM</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVO</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> \
                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TONE</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TONE_NO_TONE</span><span class="p">,</span> <span class="n">pin</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">TONE_PLAY</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">system_reset</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.servo_config">
    <p>def <span class="ident">servo_config</span>(</p><p>self, pin, min_pulse=544, max_pulse=2400)</p>
    </div>
    

    
  
    <div class="desc"><p>Configure a pin as a servo pin. Set pulse min, max in ms.</p>
<p>:param pin: Servo Pin.</p>
<p>:param min_pulse: Min pulse width in ms.</p>
<p>:param max_pulse: Max pulse width in ms.</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.servo_config', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.servo_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">servo_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">min_pulse</span><span class="o">=</span><span class="mi">544</span><span class="p">,</span> <span class="n">max_pulse</span><span class="o">=</span><span class="mi">2400</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure a pin as a servo pin. Set pulse min, max in ms.</span>
<span class="sd">    :param pin: Servo Pin.</span>
<span class="sd">    :param min_pulse: Min pulse width in ms.</span>
<span class="sd">    :param max_pulse: Max pulse width in ms.</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin</span><span class="p">,</span> <span class="n">min_pulse</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">min_pulse</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
               <span class="n">max_pulse</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">max_pulse</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SERVO_CONFIG</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.set_analog_latch">
    <p>def <span class="ident">set_analog_latch</span>(</p><p>self, pin, threshold_type, threshold_value, cb=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This method "arms" an analog pin for its data to be latched and saved in the latching table
If a callback method is provided, when latching criteria is achieved, the callback function is called
with latching data notification. In that case, the latching table is not updated.</p>
<p>:param pin: Analog pin number (value following an 'A' designator, i.e. A5 = 5</p>
<p>:param threshold_type: ANALOG_LATCH_GT | ANALOG_LATCH_LT  | ANALOG_LATCH_GTE | ANALOG_LATCH_LTE</p>
<p>:param threshold_value: numerical value - between 0 and 1023</p>
<p>:param cb: callback method</p>
<p>:return: True if successful, False if parameter data is invalid</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.set_analog_latch', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.set_analog_latch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_analog_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method &quot;arms&quot; an analog pin for its data to be latched and saved in the latching table</span>
<span class="sd">    If a callback method is provided, when latching criteria is achieved, the callback function is called</span>
<span class="sd">    with latching data notification. In that case, the latching table is not updated.</span>
<span class="sd">    :param pin: Analog pin number (value following an &#39;A&#39; designator, i.e. A5 = 5</span>
<span class="sd">    :param threshold_type: ANALOG_LATCH_GT | ANALOG_LATCH_LT  | ANALOG_LATCH_GTE | ANALOG_LATCH_LTE</span>
<span class="sd">    :param threshold_value: numerical value - between 0 and 1023</span>
<span class="sd">    :param cb: callback method</span>
<span class="sd">    :return: True if successful, False if parameter data is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span> <span class="o">&lt;=</span> <span class="n">threshold_type</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span><span class="p">:</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">threshold_value</span> <span class="o">&lt;=</span> <span class="mi">1023</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">set_analog_latch</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.set_digital_latch">
    <p>def <span class="ident">set_digital_latch</span>(</p><p>self, pin, threshold_type, cb=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This method "arms" a digital pin for its data to be latched and saved in the latching table
If a callback method is provided, when latching criteria is achieved, the callback function is called
with latching data notification. In that case, the latching table is not updated.</p>
<p>:param pin: Digital pin number</p>
<p>:param threshold_type: DIGITAL_LATCH_HIGH | DIGITAL_LATCH_LOW</p>
<p>:param cb: callback function</p>
<p>:return: True if successful, False if parameter data is invalid</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.set_digital_latch', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.set_digital_latch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_digital_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method &quot;arms&quot; a digital pin for its data to be latched and saved in the latching table</span>
<span class="sd">    If a callback method is provided, when latching criteria is achieved, the callback function is called</span>
<span class="sd">    with latching data notification. In that case, the latching table is not updated.</span>
<span class="sd">    :param pin: Digital pin number</span>
<span class="sd">    :param threshold_type: DIGITAL_LATCH_HIGH | DIGITAL_LATCH_LOW</span>
<span class="sd">    :param cb: callback function</span>
<span class="sd">    :return: True if successful, False if parameter data is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">threshold_type</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">set_digital_latch</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">threshold_type</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.set_pin_mode">
    <p>def <span class="ident">set_pin_mode</span>(</p><p>self, pin, mode, pin_type, cb=None)</p>
    </div>
    

    
  
    <div class="desc"><p>This method sets a pin to the desired pin mode for the pin_type.
It automatically enables data reporting.
NOTE: DO NOT CALL THIS METHOD FOR I2C. See i2c_config().</p>
<p>:param pin: Pin number (for analog use the analog number, for example A4: use 4)</p>
<p>:param mode: INPUT, OUTPUT, PWM, PULLUP</p>
<p>:param pin_type: ANALOG or DIGITAL</p>
<p>:param cb: This is an optional callback function to report data changes to the user</p>
<p>:return: No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.set_pin_mode', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.set_pin_mode" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_pin_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">pin_type</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method sets a pin to the desired pin mode for the pin_type.</span>
<span class="sd">    It automatically enables data reporting.</span>
<span class="sd">    NOTE: DO NOT CALL THIS METHOD FOR I2C. See i2c_config().</span>
<span class="sd">    :param pin: Pin number (for analog use the analog number, for example A4: use 4)</span>
<span class="sd">    :param mode: INPUT, OUTPUT, PWM, PULLUP</span>
<span class="sd">    :param pin_type: ANALOG or DIGITAL</span>
<span class="sd">    :param cb: This is an optional callback function to report data changes to the user</span>
<span class="sd">    :return: No return value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SET_PIN_MODE</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="c1"># enable reporting for input pins</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PULLUP</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">:</span>
            <span class="c1"># set analog response table to show this pin is an input pin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_analog_reporting</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="c1"># if not analog it has to be digital</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_CALLBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_digital_reporting</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># must be output - so set the tables accordingly</span>
        <span class="k">if</span> <span class="n">pin_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">analog_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">digital_response_table</span><span class="p">[</span><span class="n">pin</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">RESPONSE_TABLE_MODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.set_sampling_interval">
    <p>def <span class="ident">set_sampling_interval</span>(</p><p>self, interval)</p>
    </div>
    

    
  
    <div class="desc"><p>This method sends the desired sampling interval to Firmata.
Note: Standard Firmata  will ignore any interval less than 10 milliseconds</p>
<p>:param interval: Integer value for desired sampling interval in milliseconds</p>
<p>:return: No return value.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.set_sampling_interval', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.set_sampling_interval" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_sampling_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method sends the desired sampling interval to Firmata.</span>
<span class="sd">    Note: Standard Firmata  will ignore any interval less than 10 milliseconds</span>
<span class="sd">    :param interval: Integer value for desired sampling interval in milliseconds</span>
<span class="sd">    :return: No return value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">interval</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">interval</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SAMPLING_INTERVAL</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.sonar_config">
    <p>def <span class="ident">sonar_config</span>(</p><p>self, trigger_pin, echo_pin, cb=None, ping_interval=50, max_distance=200)</p>
    </div>
    

    
  
    <div class="desc"><p>Configure the pins,ping interval and maximum distance for an HC-SR04 type device.
Single pin configuration may be used. To do so, set both the trigger and echo pins to the same value.
Up to a maximum of 6 SONAR devices is supported
If the maximum is exceeded a message is sent to the console and the request is ignored.
NOTE: data is measured in centimeters</p>
<p>:param trigger_pin: The pin number of for the trigger (transmitter).</p>
<p>:param echo_pin: The pin number for the received echo.</p>
<p>:param ping_interval: Minimum interval between pings. Lowest number to use is 33 ms.Max is 127</p>
<p>:param max_distance: Maximum distance in cm. Max is 200.</p>
<p>:param cb: optional callback function to report sonar data changes</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.sonar_config', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.sonar_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">sonar_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trigger_pin</span><span class="p">,</span> <span class="n">echo_pin</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ping_interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure the pins,ping interval and maximum distance for an HC-SR04 type device.</span>
<span class="sd">    Single pin configuration may be used. To do so, set both the trigger and echo pins to the same value.</span>
<span class="sd">    Up to a maximum of 6 SONAR devices is supported</span>
<span class="sd">    If the maximum is exceeded a message is sent to the console and the request is ignored.</span>
<span class="sd">    NOTE: data is measured in centimeters</span>
<span class="sd">    :param trigger_pin: The pin number of for the trigger (transmitter).</span>
<span class="sd">    :param echo_pin: The pin number for the received echo.</span>
<span class="sd">    :param ping_interval: Minimum interval between pings. Lowest number to use is 33 ms.Max is 127</span>
<span class="sd">    :param max_distance: Maximum distance in cm. Max is 200.</span>
<span class="sd">    :param cb: optional callback function to report sonar data changes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_distance</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">max_distance_lsb</span> <span class="o">=</span> <span class="n">max_distance</span> <span class="o">&amp;</span> <span class="mh">0x7f</span>
    <span class="n">max_distance_msb</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_distance</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">trigger_pin</span><span class="p">,</span> <span class="n">echo_pin</span><span class="p">,</span> <span class="n">ping_interval</span><span class="p">,</span> <span class="n">max_distance_lsb</span><span class="p">,</span> <span class="n">max_distance_msb</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">trigger_pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">echo_pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SONAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
    <span class="c1"># update the ping data map for this pin</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sonar_config: maximum number of devices assigned - ignoring request&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_lock</span><span class="p">:</span>
            <span class="c1"># self._command_handler.active_sonar_map[trigger_pin] = self.IGNORE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">active_sonar_map</span><span class="p">[</span><span class="n">trigger_pin</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cb</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">SONAR_CONFIG</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.stepper_config">
    <p>def <span class="ident">stepper_config</span>(</p><p>self, steps_per_revolution, stepper_pins)</p>
    </div>
    

    
  
    <div class="desc"><p>Configure stepper motor prior to operation.</p>
<p>:param steps_per_revolution: number of steps per motor revolution</p>
<p>:param stepper_pins: a list of control pin numbers - either 4 or 2</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.stepper_config', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.stepper_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stepper_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps_per_revolution</span><span class="p">,</span> <span class="n">stepper_pins</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure stepper motor prior to operation.</span>
<span class="sd">    :param steps_per_revolution: number of steps per motor revolution</span>
<span class="sd">    :param stepper_pins: a list of control pin numbers - either 4 or 2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_CONFIGURE</span><span class="p">,</span> <span class="n">steps_per_revolution</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">steps_per_revolution</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stepper_pins</span><span class="p">)):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stepper_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.stepper_request_library_version">
    <p>def <span class="ident">stepper_request_library_version</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Request the stepper library version from the Arduino.
To retrieve the version after this command is called, call
get_stepper_version</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.stepper_request_library_version', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.stepper_request_library_version" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stepper_request_library_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request the stepper library version from the Arduino.</span>
<span class="sd">    To retrieve the version after this command is called, call</span>
<span class="sd">    get_stepper_version</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_LIBRARY_VERSION</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="PyMata.pymata.PyMata.stepper_step">
    <p>def <span class="ident">stepper_step</span>(</p><p>self, motor_speed, number_of_steps)</p>
    </div>
    

    
  
    <div class="desc"><p>Move a stepper motor for the number of steps at the specified speed</p>
<p>:param motor_speed: 21 bits of data to set motor speed</p>
<p>:param number_of_steps: 14 bits for number of steps &amp; direction
                        positive is forward, negative is reverse</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-PyMata.pymata.PyMata.stepper_step', this);">Show source &equiv;</a></p>
  <div id="source-PyMata.pymata.PyMata.stepper_step" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stepper_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor_speed</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move a stepper motor for the number of steps at the specified speed</span>
<span class="sd">    :param motor_speed: 21 bits of data to set motor speed</span>
<span class="sd">    :param number_of_steps: 14 bits for number of steps &amp; direction</span>
<span class="sd">                            positive is forward, negative is reverse</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">number_of_steps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">abs_number_of_steps</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">STEPPER_STEP</span><span class="p">,</span> <span class="n">motor_speed</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">motor_speed</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">motor_speed</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
            <span class="n">abs_number_of_steps</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">abs_number_of_steps</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="n">direction</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_handler</span><span class="o">.</span><span class="n">STEPPER_DATA</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="PyMata.pymata.PyMata.baud_rate" class="name">var <span class="ident">baud_rate</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
